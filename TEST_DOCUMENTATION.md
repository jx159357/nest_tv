# Nest TV 视频流媒体平台测试文档

## 1. 项目概述

### 1.1 项目简介
Nest TV 是一个基于 NestJS + Vue3 的现代化视频流媒体平台，提供影视内容管理、用户认证、多源播放、个性化推荐等核心功能。

### 1.2 技术栈
- **后端**: NestJS + TypeScript + TypeORM + MySQL + Redis + JWT
- **前端**: Vue3 + Composition API + Vite + UnoCSS + Pinia
- **其他**: HLS.js、WebTorrent、Puppeteer、代理池等

### 1.3 核心功能模块
- 用户注册/登录/认证
- 影视资源管理（CRUD）
- 多源播放支持（在线、磁力链接、HLS等）
- 观看历史记录
- 个性化推荐系统
- IPTV直播频道
- 爬虫数据采集
- 后台管理系统
- 权限管理
- 弹幕系统

## 2. 测试环境准备

### 2.1 环境要求
- Node.js >= 18.0.0
- MySQL >= 8.0
- Redis >= 6.0
- npm 或 yarn

### 2.2 启动服务

#### 后端服务
```bash
cd backend
npm install
npm run start:dev
```
服务地址: http://localhost:3334

#### 前端服务
```bash
cd frontend
npm install
npm run dev
```
服务地址: http://localhost:5173

### 2.3 数据库初始化
```bash
cd backend
npm run init-database  # 如果存在
# 或启动时 TypeORM 自动创建表结构
```

## 3. 功能测试用例

### 3.1 用户认证模块测试

#### 3.1.1 用户注册测试
**测试路径**: `/register`

| 测试用例编号 | 测试描述 | 输入数据 | 预期结果 | 优先级 |
|-------------|---------|---------|---------|--------|
| AUTH-REG-001 | 正常注册 | 有效用户名、邮箱、密码 | 注册成功，返回用户信息 | 高 |
| AUTH-REG-002 | 重复邮箱 | 已存在的邮箱 | 返回错误提示"邮箱已存在" | 高 |
| AUTH-REG-003 | 弱密码 | 密码长度<6 | 返回错误提示"密码至少6位" | 中 |
| AUTH-REG-004 | 邮箱格式错误 | invalid-email | 返回错误提示"邮箱格式不正确" | 中 |
| AUTH-REG-005 | 空字段提交 | 缺少必填字段 | 返回相应字段必填提示 | 高 |

**测试步骤**:
1. 访问注册页面
2. 输入测试数据
3. 提交表单
4. 验证响应结果
5. 检查数据库用户表

#### 3.1.2 用户登录测试
**测试路径**: `/login`

| 测试用例编号 | 测试描述 | 输入数据 | 预期结果 | 优先级 |
|-------------|---------|---------|---------|--------|
| AUTH-LOGIN-001 | 正常登录 | 正确用户名/密码 | 登录成功，返回JWT Token | 高 |
| AUTH-LOGIN-002 | 错误密码 | 正确用户名，错误密码 | 返回错误提示"密码错误" | 高 |
| AUTH-LOGIN-003 | 用户不存在 | 不存在的用户名 | 返回错误提示"用户不存在" | 高 |
| AUTH-LOGIN-004 | 空字段登录 | 缺少用户名或密码 | 返回相应字段必填提示 | 中 |
| AUTH-LOGIN-005 | Token验证 | 使用返回的Token访问受保护接口 | 访问成功 | 高 |

### 3.2 影视资源管理测试

#### 3.2.1 影视资源列表测试
**测试路径**: `GET /media`

| 测试用例编号 | 测试描述 | 查询参数 | 预期结果 | 优先级 |
|-------------|---------|---------|---------|--------|
| MEDIA-LIST-001 | 获取所有资源 | 无 | 返回分页的影视资源列表 | 高 |
| MEDIA-LIST-002 | 按类型筛选 | type=movie | 返回电影类型资源 | 高 |
| MEDIA-LIST-003 | 按评分筛选 | minRating=8.5 | 返回评分>=8.5的资源 | 中 |
| MEDIA-LIST-004 | 关键词搜索 | keyword=复仇者联盟 | 返回相关搜索结果 | 高 |
| MEDIA-LIST-005 | 分页测试 | page=1,limit=10 | 返回第1页，每页10条 | 高 |

#### 3.2.2 影视资源详情测试
**测试路径**: `GET /media/:id`

| 测试用例编号 | 测试描述 | 输入 | 预期结果 | 优先级 |
|-------------|---------|------|---------|--------|
| MEDIA-DETAIL-001 | 正常获取详情 | 存在的资源ID | 返回完整资源信息 | 高 |
| MEDIA-DETAIL-002 | 资源不存在 | 不存在的ID | 返回404错误 | 高 |
| MEDIA-DETAIL-003 | 无效ID格式 | 非数字ID | 返回400错误 | 中 |

#### 3.2.3 影视资源创建测试（管理员）
**测试路径**: `POST /media`

| 测试用例编号 | 测试描述 | 输入数据 | 预期结果 | 优先级 |
|-------------|---------|---------|---------|--------|
| MEDIA-CREATE-001 | 创建电影 | 完整电影信息 | 创建成功，返回新资源 | 高 |
| MEDIA-CREATE-002 | 创建电视剧 | 完整电视剧信息 | 创建成功，返回新资源 | 高 |
| MEDIA-CREATE-003 | 缺少必填字段 | 缺少title | 返回400错误 | 中 |
| MEDIA-CREATE-004 | 无权限访问 | 普通用户Token | 返回403权限错误 | 高 |
| MEDIA-CREATE-005 | 重复资源 | 相同title和year | 返回冲突提示 | 中 |

### 3.3 播放源管理测试

#### 3.3.1 获取播放源测试
**测试路径**: `GET /play-sources/media/:id`

| 测试用例编号 | 测试描述 | 输入 | 预期结果 | 优先级 |
|-------------|---------|------|---------|--------|
| PLAY-SOURCE-001 | 获取播放源 | 存在的媒体ID | 返回所有可用播放源 | 高 |
| PLAY-SOURCE-002 | 媒体不存在 | 不存在的ID | 返回404错误 | 高 |
| PLAY-SOURCE-003 | 获取最佳播放源 | /best接口 | 返回优先级最高的可用源 | 高 |

#### 3.3.2 添加播放源测试（管理员）
**测试路径**: `POST /play-sources`

| 测试用例编号 | 测试描述 | 输入数据 | 预期结果 | 优先级 |
|-------------|---------|---------|---------|--------|
| PLAY-SOURCE-001 | 添加在线源 | 在线播放URL | 创建成功 | 高 |
| PLAY-SOURCE-002 | 添加磁力源 | 磁力链接URL | 创建成功 | 中 |
| PLAY-SOURCE-003 | 无效URL | 格式错误的URL | 返回400错误 | 中 |
| PLAY-SOURCE-004 | 无权限 | 普通用户Token | 返回403错误 | 高 |

### 3.4 观看历史测试

#### 3.4.1 记录观看历史
**测试路径**: `POST /watch-history`

| 测试用例编号 | 测试描述 | 输入数据 | 预期结果 | 优先级 |
|-------------|---------|---------|---------|--------|
| HISTORY-001 | 记录观看进度 | 媒体ID、进度、时间戳 | 记录成功 | 高 |
| HISTORY-002 | 更新观看进度 | 相同媒体，新进度 | 更新成功 | 高 |
| HISTORY-003 | 无效进度 | 进度>100%或<0 | 返回400错误 | 中 |
| HISTORY-004 | 未登录访问 | 无Token | 返回401错误 | 高 |

#### 3.4.2 获取观看历史
**测试路径**: `GET /watch-history`

| 测试用例编号 | 测试描述 | 查询参数 | 预期结果 | 优先级 |
|-------------|---------|---------|---------|--------|
| HISTORY-LIST-001 | 获取历史记录 | 无 | 返回用户观看历史 | 高 |
| HISTORY-LIST-002 | 分页获取 | page=1,limit=20 | 分页返回历史 | 中 |
| HISTORY-LIST-003 | 按媒体筛选 | mediaId=123 | 特定媒体的历史记录 | 中 |

### 3.5 推荐系统测试

#### 3.5.1 获取推荐内容
**测试路径**: `GET /recommendations`

| 测试用例编号 | 测试描述 | 查询参数 | 预期结果 | 优先级 |
|-------------|---------|---------|---------|--------|
| RECOMMEND-001 | 个性化推荐 | 无 | 基于用户历史的推荐 | 高 |
| RECOMMEND-002 | 热门推荐 | type=popular | 热门内容推荐 | 高 |
| RECOMMEND-003 | 相似推荐 | basedOn=123 | 基于媒体的相似推荐 | 中 |
| RECOMMEND-004 | 分类推荐 | genre=动作 | 动作类推荐 | 中 |

### 3.6 IPTV直播测试

#### 3.6.1 获取频道列表
**测试路径**: `GET /iptv/channels`

| 测试用例编号 | 测试描述 | 查询参数 | 预期结果 | 优先级 |
|-------------|---------|---------|---------|--------|
| IPTV-001 | 获取所有频道 | 无 | 返回频道列表 | 高 |
| IPTV-002 | 按分类筛选 | category=体育 | 体育类频道 | 中 |
| IPTV-003 | 搜索频道 | keyword=CCTV | 相关频道 | 中 |

#### 3.6.2 播放直播流
**测试路径**: `GET /iptv/play/:channelId`

| 测试用例编号 | 测试描述 | 输入 | 预期结果 | 优先级 |
|-------------|---------|------|---------|--------|
| IPTV-PLAY-001 | 正常播放 | 存在的频道ID | 返回播放流地址 | 高 |
| IPTV-PLAY-002 | 频道不存在 | 不存在的ID | 返回404错误 | 高 |

### 3.7 爬虫系统测试

#### 3.7.1 手动触发爬虫
**测试路径**: `POST /crawler/trigger`

| 测试用例编号 | 测试描述 | 输入数据 | 预期结果 | 优先级 |
|-------------|---------|---------|---------|--------|
| CRAWLER-001 | 触发爬虫任务 | 爬虫配置 | 任务创建成功 | 中 |
| CRAWLER-002 | 获取爬虫状态 | 无 | 返回爬虫运行状态 | 中 |
| CRAWLER-003 | 无权限访问 | 普通用户 | 返回403错误 | 高 |

#### 3.7.2 获取爬虫目标
**测试路径**: `GET /crawler/targets`

| 测试用例编号 | 测试描述 | 预期结果 | 优先级 |
|-------------|---------|--------|
| CRAWLER-TARGETS-001 | 获取爬虫目标列表 | 返回配置的爬虫目标 | 中 |

### 3.8 管理后台测试

#### 3.8.1 仪表板数据
**测试路径**: `GET /admin/dashboard`

| 测试用例编号 | 测试描述 | 预期结果 | 优先级 |
|-------------|---------|--------|
| ADMIN-DASH-001 | 获取统计数据 | 用户数、媒体数、播放数等 | 高 |
| ADMIN-DASH-002 | 无权限访问 | 普通用户Token | 返回403错误 | 高 |

#### 3.8.2 用户管理
**测试路径**: `GET /admin/users`

| 测试用例编号 | 测试描述 | 查询参数 | 预期结果 | 优先级 |
|-------------|---------|---------|---------|--------|
| ADMIN-USERS-001 | 获取用户列表 | 无 | 分页返回用户列表 | 高 |
| ADMIN-USERS-002 | 搜索用户 | keyword=test | 搜索结果 | 中 |
| ADMIN-USERS-003 | 禁用用户 | POST /admin/users/:id/ban | 用户状态变为禁用 | 高 |

## 4. 前端界面测试

### 4.1 页面加载测试

| 测试用例编号 | 测试页面 | 预期行为 | 优先级 |
|-------------|---------|---------|--------|
| UI-LOAD-001 | 首页 | 正常加载，显示热门和最新内容 | 高 |
| UI-LOAD-002 | 登录页 | 表单正常显示和交互 | 高 |
| UI-LOAD-003 | 注册页 | 表单验证正常工作 | 高 |
| UI-LOAD-004 | 影视详情页 | 显示影视信息和播放源 | 高 |
| UI-LOAD-005 | 个人中心 | 显示用户信息和历史记录 | 中 |
| UI-LOAD-006 | 管理后台 | 需要管理员权限 | 高 |

### 4.2 交互功能测试

| 测试用例编号 | 测试功能 | 预期行为 | 优先级 |
|-------------|---------|---------|--------|
| UI-INTERACT-001 | 搜索功能 | 输入关键词，回车或点击搜索 | 高 |
| UI-INTERACT-002 | 媒体卡片点击 | 跳转到详情页 | 高 |
| UI-INTERACT-003 | 播放按钮 | 开始播放视频 | 高 |
| UI-INTERACT-004 | 收藏功能 | 添加/取消收藏 | 中 |
| UI-INTERACT-005 | 分页导航 | 正常切换页面 | 中 |
| UI-INTERACT-006 | 响应式布局 | 移动端/桌面端适配 | 高 |

### 4.3 错误处理测试

| 测试用例编号 | 测试场景 | 预期行为 | 优先级 |
|-------------|---------|---------|--------|
| UI-ERROR-001 | 网络错误 | 显示错误提示，提供重试 | 高 |
| UI-ERROR-002 | 404页面 | 友好的404页面 | 中 |
| UI-ERROR-003 | 权限不足 | 跳转登录页或显示权限提示 | 高 |
| UI-ERROR-004 | 加载失败 | 显示加载失败状态 | 中 |

## 5. 集成测试用例

### 5.1 用户流程集成测试

#### 5.1.1 完整用户注册到观看流程

**测试步骤**:
1. 用户注册新账号
2. 登录验证
3. 浏览首页内容
4. 搜索感兴趣的影视
5. 查看影视详情
6. 选择播放源开始观看
7. 观看一段时间后关闭
8. 查看观看历史记录

**预期结果**: 整个流程无中断，数据一致性正确

#### 5.1.2 管理员管理流程

**测试步骤**:
1. 管理员登录
2. 进入管理后台
3. 查看系统统计数据
4. 添加新的影视资源
5. 配置播放源
6. 查看用户列表
7. 管理用户权限

**预期结果**: 管理功能正常，权限控制有效

### 5.2 系统集成测试

#### 5.2.1 缓存集成测试

**测试场景**:
- Redis缓存失效时访问数据库
- 热门内容缓存更新
- 用户会话缓存管理

#### 5.2.2 数据库集成测试

**测试场景**:
- 事务回滚
- 并发访问
- 数据一致性验证

#### 5.2.3 外部服务集成测试

**测试场景**:
- 爬虫服务数据采集
- 代理池服务调用
- 第三方解析服务

## 6. 性能测试用例

### 6.1 前端性能测试

| 测试指标 | 测试方法 | 目标值 | 优先级 |
|---------|---------|--------|--------|
| 首屏加载时间 | Lighthouse | <3秒 | 高 |
| 页面切换响应时间 | 开发者工具 | <500ms | 高 |
| 内存使用量 | DevTools Memory | <50MB | 中 |
| 包大小 | Bundle Analyzer | <2MB | 高 |

### 6.2 后端API性能测试

| 测试场景 | 并发数 | 响应时间目标 | 错误率目标 | 优先级 |
|---------|--------|-------------|-----------|--------|
| 获取媒体列表 | 100 | <500ms | <1% | 高 |
| 用户认证 | 50 | <200ms | <0.5% | 高 |
| 搜索接口 | 80 | <800ms | <2% | 中 |
| 管理后台数据 | 20 | <1s | <1% | 中 |

### 6.3 数据库性能测试

| 测试场景 | 查询类型 | 期望性能 | 优先级 |
|---------|---------|---------|--------|
| 复杂搜索查询 | SELECT with JOIN | <1s | 高 |
| 大数据分页 | LIMIT/OFFSET | <500ms | 高 |
| 写入操作 | INSERT/UPDATE | <200ms | 中 |

## 7. 安全测试用例

### 7.1 认证安全测试

| 测试用例编号 | 测试描述 | 测试方法 | 预期结果 | 优先级 |
|-------------|---------|---------|---------|--------|
| SECURITY-001 | SQL注入 | 登录框输入恶意SQL | 被防御，无SQL错误 | 高 |
| SECURITY-002 | XSS攻击 | 评论框输入脚本 | 脚本被转义 | 高 |
| SECURITY-003 | CSRF攻击 | 跨站请求伪造 | CSRF Token验证 | 高 |
| SECURITY-004 | 暴力破解 | 多次错误登录尝试 | 账户锁定或验证码 | 中 |
| SECURITY-005 | JWT伪造 | 伪造Token访问 | 验证失败 | 高 |

### 7.2 权限测试

| 测试用例编号 | 测试描述 | 测试方法 | 预期结果 | 优先级 |
|-------------|---------|---------|---------|--------|
| SECURITY-PERM-001 | 垂直权限提升 | 普通用户访问管理员接口 | 返回403 | 高 |
| SECURITY-PERM-002 | 水平权限访问 | 用户A访问用户B数据 | 返回403 | 高 |
| SECURITY-PERM-003 | 越权访问 | 未登录访问受保护资源 | 返回401 | 高 |

## 8. 兼容性测试

### 8.1 浏览器兼容性

| 浏览器 | 版本要求 | 测试范围 | 优先级 |
|--------|---------|---------|--------|
| Chrome | >= 90 | 完整功能测试 | 高 |
| Firefox | >= 88 | 完整功能测试 | 高 |
| Safari | >= 14 | 完整功能测试 | 中 |
| Edge | >= 90 | 完整功能测试 | 中 |
| 移动端浏览器 | iOS/Android最新 | 基础功能测试 | 高 |

### 8.2 设备兼容性

| 设备类型 | 分辨率 | 测试重点 | 优先级 |
|---------|--------|---------|--------|
| 桌面端 | >=1920x1080 | 完整功能 | 高 |
| 笔记本 | 1366x768 | 布局适配 | 中 |
| 平板 | 768x1024 | 触摸交互 | 高 |
| 手机 | 375x667 | 响应式布局 | 高 |

## 9. 数据验证测试

### 9.1 输入验证

| 输入字段 | 验证规则 | 测试用例 | 优先级 |
|---------|---------|---------|--------|
| 用户名 | 3-20字符，字母数字下划线 | 边界值、特殊字符 | 高 |
| 邮箱 | 标准邮箱格式 | 各种格式测试 | 高 |
| 密码 | 最少6位，包含字母数字 | 弱密码测试 | 高 |
| 搜索关键词 | 长度限制，XSS过滤 | 特殊字符输入 | 中 |

### 9.2 数据完整性

| 测试场景 | 验证方法 | 预期结果 | 优先级 |
|---------|---------|---------|--------|
| 外键约束 | 删除被引用记录 | 约束错误 | 高 |
| 数据类型 | 插入错误类型 | 类型错误 | 高 |
| 必填字段 | 提交空值 | 必填验证 | 高 |

## 10. 测试执行计划

### 10.1 测试阶段

#### 第一阶段：基础功能测试（2天）
- 用户认证模块
- 基础CRUD操作
- 页面加载测试

#### 第二阶段：核心业务测试（3天）
- 播放功能测试
- 观看历史测试
- 推荐系统测试
- IPTV功能测试

#### 第三阶段：管理功能测试（2天）
- 管理后台功能
- 权限控制测试
- 爬虫系统测试

#### 第四阶段：性能和安全测试（2天）
- 性能压力测试
- 安全漏洞测试
- 兼容性测试

#### 第五阶段：集成和验收测试（1天）
- 端到端流程测试
- 数据一致性验证
- 问题修复验证

### 10.2 测试环境要求

- 独立的测试数据库
- 模拟的生产环境配置
- 完整的测试数据集
- 性能监控工具

## 11. 缺陷管理

### 11.1 缺陷等级定义

- **P0 - 严重**: 系统崩溃、数据丢失、安全漏洞
- **P1 - 高**: 核心功能无法使用、严重影响用户体验
- **P2 - 中**: 次要功能问题、UI布局问题
- **P3 - 低**: 轻微UI问题、文案错误

### 11.2 缺陷报告模板

```
缺陷标题: [模块] 简要描述
复现步骤: 
1. 
2. 
3. 

期望结果: 
实际结果: 
严重等级: P0/P1/P2/P3
环境信息: 浏览器/操作系统
截图/日志: 
```

## 12. 上线标准

### 12.1 功能完整性要求
- [ ] 所有P0、P1级别缺陷已修复
- [ ] 核心功能100%可用
- [ ] 管理后台功能正常
- [ ] 用户注册登录流程完整

### 12.2 性能要求
- [ ] 首页加载时间<3秒
- [ ] API响应时间<1秒（95%请求）
- [ ] 系统支持100并发用户
- [ ] 数据库查询优化完成

### 12.3 安全要求
- [ ] 通过基础安全测试
- [ ] 无严重安全漏洞
- [ ] 权限控制有效
- [ ] 输入验证完整

### 12.4 兼容性要求
- [ ] 主流浏览器兼容
- [ ] 移动端基础功能正常
- [ ] 响应式布局正确

### 12.5 文档要求
- [ ] API文档完整
- [ ] 用户手册准备
- [ ] 部署文档更新
- [ ] 运维监控配置

## 13. 回归测试清单

每次代码变更后需要执行的核心测试：

- [ ] 用户注册登录功能
- [ ] 首页加载和搜索
- [ ] 影视详情和播放
- [ ] 观看历史记录
- [ ] 管理员登录和基础操作
- [ ] 数据库连接正常
- [ ] Redis缓存功能
- [ ] 错误页面处理

## 14. 测试工具推荐

### 14.1 自动化测试工具
- **Cypress**: 端到端测试
- **Jest**: 单元测试
- **Supertest**: API测试
- **Postman**: API手动测试

### 14.2 性能测试工具
- **Apache JMeter**: 压力测试
- **Lighthouse**: 前端性能
- **Chrome DevTools**: 调试和性能分析

### 14.3 安全测试工具
- **OWASP ZAP**: 安全扫描
- **SQLMap**: SQL注入测试
- **Burp Suite**: Web应用安全测试

---

**文档版本**: v1.0  
**更新日期**: 2024-01-21  
**测试负责人**: [指定测试负责人]  
**审核人**: [技术负责人]

**注意**: 本测试文档应根据项目实际开发进度和具体需求进行相应调整。在执行测试过程中，如发现新的测试场景或潜在问题，请及时更新本文档。